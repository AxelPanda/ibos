/*! IBOS_Revolution2014-03-22 */
var Ibosapp={formValidate:{pageError:function(a,b){var c;this.errorFocus&&(c=$.data(b,"select2"))&&c.focus()},setGroupState:function(a,b){var c=$(a).closest(".input-group"),d="input-group-error",e="input-group-correct";switch(b){case"correct":c.removeClass(d).addClass(e);break;case"error":c.removeClass(e).addClass(d);break;default:c.removeClass(e).removeClass(d)}}},stampPicker:function(a,b,c){b=b||[];var d=c||Number(a.attr("data-value")),e=!1,f=function(a){a.stopPropagation()},g=function(){var a,c;a='<table class="stamp-table"><tbody>';for(var e=0,f=b.length;f>e;e++)c=b[e].value===d,0===e?a+="<tr>":e%5===0&&(a+="</tr><tr>"),a+='<td><div class="stamp-item'+(c?" active":"")+'" data-node-type="stampItem" title="'+b[e].title+'" data-stamp="'+b[e].stamp+'" data-path="'+b[e].path+'" data-value="'+b[e].value+'"><div class="stamp-img-wrap"><img width="60" height="24" src="'+b[e].path+'" alt="'+b[e].title+'"/></div><div class="stamp-point"><strong>'+(b[e].point||0)+"</strong>"+U.lang("YUANCAPITAL.CENT")+"</div></div></td>",e===b.length-1&&(a+="</tr>");return a};Ui.popover(a,{content:function(){return g(c)},html:!0}),a.on("shown",function(){var b=$.data(this,"popover"),c=$.attr(this,"data-value");b.$tip.find("[data-node-type='stampItem']").each(function(){$.attr(this,"data-value")===c&&$(this).addClass("active")}),e||(b.$tip.on("click","[data-node-type='stampItem']",function(){var c=Number($.attr(this,"data-value")),e=$.attr(this,"data-path"),f=$.attr(this,"data-stamp");isNaN(c)||(b.$tip.find("a").removeClass("active"),$(this).addClass("active"),d=c,a.attr("data-value",d).trigger("stampChange",{value:d,path:e,stamp:f}),b.hide())}).on("mousedown",f),e=!0)}).on("mousedown",f),$(document).on("mousedown",function(){a.popover("hide")})},dropnotify:{init:function(a,b){this.dropclass=a,this.$container=$("#"+b),this.count()},show:function(){this.$container.show()},hide:function(){this.$container.hide(),U.setCookie("dropnotify",$.toJSON(this.data),2592e3)},count:function(){var a=this,b=function(){$.get(Ibos.app.url("message/api/getunreadcount"),function(b){var c,d=b.data;return!b||"undefined"!=typeof b.data&&1===b.status?(c=U.getCookie("dropnotify"),c&&U.getCookie("dropnotify")==$.toJSON(b.data)?!1:(a.data=b.data,d.unread_total<=0?(a.hide(),!1):(a.show(),void $("."+a.dropclass).each(function(){$(this).find("li").each(function(){var a=$(this).attr("rel");num=d[a],num>0?($(this).find("span").html("<strong class='xco'>"+num+"</strong> "+U.lang("DN."+a.toUpperCase())),$(this).show()):$(this).hide()})})))):!1},"json")};setInterval(b,6e4),b()}}};$(function(){Ibos.loginCard=function(){var a=$("#user_login_ctrl"),b=$("#user_login_card"),c=new Ui.PopMenu(a,b,{position:{at:"right bottom",my:"right top+25",of:a},showDelay:0,animate:!0});return b.on("show",function(){a.addClass("active")}).on("hide",function(){a.removeClass("active")}),{show:function(){c.show()},hide:function(){c.hide()}}}(),Ibos.userCard=function(){var a,b,c=$("#ui_card"),d=500;c&&c.length||(c=$("<div id='ui_card' class='ui-card'></div>").appendTo(document.body));var e=function(a,d){var e=c.data("usercard_"+a.uid),f=function(){c.position({at:"left top",my:"left bottom-5",of:d})};return clearTimeout(b),c.show().empty(),f(),c.waiting(null,"small"),e?void c.waiting(!1).html(e):void $.get(Ibos.app.url("user/info/usercard"),a,function(b){b&&c.waiting(!1).html(b).data("usercard_"+a.uid,b)})},f=function(){b=setTimeout(function(){c.hide().waiting(!1)},d)};return $(document).on({mouseenter:function(){var b=$(this),c=U.urlToObj($.attr(this,"data-param"));a=setTimeout(function(){e(c,b)},d)},mouseleave:function(){clearTimeout(a),f()}},"[data-toggle='usercard']"),c.on({mouseenter:function(){clearTimeout(b)},mouseleave:f}),{hide:f,show:e}}(),$("#nv li").each(function(){var a=$(this),b=$(a.attr("data-target"));new Ui.PopMenu(a,b,{position:{my:"left top-10"},hideDelay:0,showDelay:0}),b.on({show:function(){a.addClass("open")},hide:function(){a.removeClass("open")}})}),Ibos.app.g("creditRemind")&&U.getCookie("creditremind")&&Ui.showCreditPrompt()}),Ibos.search=function(){var a,b,c,d="mn_search",e=!0,f=!0,g=function(){return j()?void a.get(0).form.submit():($.jGrowl(L.KEYWORD_CANNOT_BE_EMPTY,{theme:"warning"}),!1)},h=function(){return!0},i=function(){var a=$("#mn_search_advance_form");$.artDialog({id:"d_advance",title:L.ADVANCED_SETTING,content:document.getElementById("mn_search_advance"),cancel:!0,init:function(){a.get(0)&&a.get(0).reset()},ok:function(){var b=a.serializeArray();h.call(null,a,b)}})},j=function(){return!!$.trim(a.val())},k=function(){c.addClass("has-focus"),f=!1},l=function(){j()||(c.removeClass("has-focus"),e&&(f=!0))},m=function(){a.on({keydown:function(a){return 13===a.which?(g(),!1):void 0},focus:k,blur:l}),b.on("click",function(){f?i():g()})},n=function(){c.removeClass("search-config"),e=!1},o=function(){c.addClass("search-config"),e=!0},p=function(){return a=$("#"+d),a.get(0)?(c=a.parent(),b=a.next(),m(),void 0):!1},q=function(a){$.isFunction(a)&&(g=a)},r=function(a){$.isFunction(a)&&(i=a)},s=function(a){$.isFunction(a)&&(h=a)};return{init:p,disableAdvance:n,enableAdvance:o,setSubmit:q,setAdvance:r,setAdvanceSubmit:s}}(),$(function(){Ibos.evt.add({showCert:function(){Ui.ajaxDialog(Ibos.app.url("main/default/getCert"),{id:"d_cert",title:!1,ok:!1,width:661,height:471,padding:0})},follow:function(a,b){var c=$(b);c.button("loading"),a.formhash=Ibos.app.g("formHash"),$.post(Ibos.app.url("message/api/dofollow"),a,function(b){return c.button("reset"),b.isSuccess?(c.html(b.both?'<i class="om-geoc"></i> '+U.lang("WB.FOLLOWBOTH"):'<i class="om-gcheck"></i> '+U.lang("WB.FOLLOWED")).removeClass("btn-warning").attr({"data-action":"unfollow","data-node-type":"unfollowBtn","data-loading-text":U.lang("WB.UNFOLLOWING")}).data("loading-text",U.lang("WB.UNFOLLOWING")),void setTimeout(function(){$("#ui_card").data("usercard_"+a.fid,$("#ui_card").html())},0)):(Ui.tip(b.msg,"danger"),!1)},"json")},unfollow:function(a,b){var c=$(b);c.button("loading"),a.formhash=Ibos.app.g("formHash"),$.post(Ibos.app.url("message/api/unfollow"),a,function(b){return c.button("reset"),b.isSuccess?(c.html('<i class="om-plus"></i> '+U.lang("WB.FOLLOW")).removeClass("btn-danger").addClass("btn-warning").attr("data-action","follow").attr("data-loading-text",U.lang("WB.FOLLOWING")).data("loading-text",U.lang("WB.FOLLOWING")).removeAttr("data-node-type"),void setTimeout(function(){$("#ui_card").data("usercard_"+a.fid,$("#ui_card").html())},0)):(Ui.tip(b.msg,"danger"),!1)},"json")}}),document.getElementById("message_container")&&setTimeout(function(){Ibosapp.dropnotify.init("reminder-list","message_container")},Ibos.app.g("settings").notifyInterval);var a=$(document);a.on("click","[data-toggle='display']",function(){var a=$.attr(this,"data-toggle-show"),b=$.attr(this,"data-toggle-hide");a&&$(a).show(),b&&$(b).hide()}),a.on({focus:function(){$(this).parent().addClass("has-focus")},blur:function(){$(this).parent().removeClass("has-focus")}},"input:not([nofocus])"),a.on({mouseenter:function(){var a=$(this);a.data("oldHtml",a.html()).addClass("btn-danger").html('<i class="om-chi"></i> '+U.lang("WB.UNFOLLOW"))},mouseleave:function(){var a=$(this);a.removeClass("btn-danger").html(a.data("oldHtml"))}},'[data-node-type="unfollowBtn"]')}),function(){var a,b=function(a){if(UE)if("string"==typeof a){for(var b in UE.instants)if(UE.instants[b].key===a)return UE.instants[b]}else if(a instanceof UE.Editor)return a;return!1};Ibosapp.editor={setLocal:function(a){var c;return a=b(a),a?(c=a.getContent(!1,!1,!1,!0),Ibos.local.set("ue_"+a.key+location.search,c),!0):!1},getLocal:function(a){var b="string"==typeof a?a:a.key;return Ibos.local.get("ue_"+(b||"")+location.search)||""},restoreLocal:function(a){var c,d=this;a=b(a),a&&(c=d.getLocal(a.key),c&&a.setContent(c),Ibos.ignoreFormChange())},clearLocal:function(a){var b="string"==typeof a?a:a.key;return Ibos.local.remove("ue_"+(b||"")+location.search)},initLocal:function(b){var c=this;this.restoreLocal(b),a=setInterval(function(){c.setLocal(b)},3e3)}}}();